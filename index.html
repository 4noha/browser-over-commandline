<!-- まぁindex2　と同じ　加速度センサーをつかうからあれ？テストしにくいの？ -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>端末のセンサ値を取得する方法 - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/nakashimmer/yy7X -->
<!-- Copyright nakashimmer - http://jsdo.it/nakashimmer -->
<!-- All Rights Reserved. -->
<meta name = viewport content="width=device-width,user-scalable=no,
initial-scale=1.0,maximum-scale=1.0" />

<meta name = "apple-mobile-web-app-capable" content="yes" /> 
<link rel = "apple-touch-startup-image" href="startup.png" /> 
<link rel = "apple-touch-icon" href="touch-icon-iphone.png" />

<p id="gra">重力加速度</p>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.4.3.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
	var gra={x:0,y:0,z:0};
	
	  //var s = io.connect('http://172.20.10.6:3000'); //リモート
	  var s = io.connect('http://10.0.1.3:3000'); //リモート
	//var s = io.connect('http://localhost:3000'); //ローカル

  //サーバから受け取るイベント
  s.on("connect", function () {});  // 接続時
  s.on("disconnect", function (client) {});  // 切断時
  s.on("S_to_C_message", function (data) {
    addMessage(data.value);
  });

  //jqueryでメッセージを追加
  function addMessage (value,color,size) {
    //var msg = value.replace( /[!@$%<>'"&|]/g, '' ); //タグ記号とかいくつか削除
    //$("#msg_list").prepend("<div class='msg'>" + msg + "</div>");
  } 

	window.addEventListener('devicemotion', function(e) {
    
	// 重力加速度  ※iOS4.2 Android 3 以上
    gra.x = e.accelerationIncludingGravity.x; //x方向の傾き重力加速度
    gra.y = e.accelerationIncludingGravity.y; //y方向の傾き重力加速度
    gra.z = e.accelerationIncludingGravity.z; //z方向の傾き重力加速度
    document.getElementById('gra').innerHTML
	='<dt>重力加速度：'
	+'<dd>x='+gra.x.toFixed(2)
	+'<dd>y='+gra.y.toFixed(2);
	if(gra.y > 4 && gra.x>-1 && gra.x<1){
	    s.emit("C_to_S_message", {value:"1"}); //サーバへ送信
		document.getElementById('gra').innerHTML=document.getElementById('gra').innerHTML+"↓"
	}else if(gra.y < -5 && gra.x>-1 && gra.x<1){
	    s.emit("C_to_S_message", {value:"8"});
		document.getElementById('gra').innerHTML=document.getElementById('gra').innerHTML+"↑"
	}else if(gra.y>1 && gra.x > 1){
	    s.emit("C_to_S_message", {value:"3"});
		document.getElementById('gra').innerHTML=document.getElementById('gra').innerHTML+"↓←"
	}else if(gra.y>1 && gra.x < -1){
	    s.emit("C_to_S_message", {value:"c"});//先頭１文字だけだし１２ってしたら１	
		document.getElementById('gra').innerHTML=document.getElementById('gra').innerHTML+"↓→"
	}else if(gra.y<-1 && gra.x > 1){
	    s.emit("C_to_S_message", {value:"a"});	
		document.getElementById('gra').innerHTML=document.getElementById('gra').innerHTML+"↑←"
	}else if(gra.y<-1 && gra.x < -1){
	    s.emit("C_to_S_message", {value:"5"});	
		document.getElementById('gra').innerHTML=document.getElementById('gra').innerHTML+"↑→"
	}else{
	    s.emit("C_to_S_message", {value:"0"});
	}
	});
</script>
</body>
</html>
